{{define "extrastyles"}}
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.13/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../assets/global/css/bootstrap-year-calendar.min.css">
  <style>
      .nwDate {
          white-space: nowrap;
      }
      ul.page-breadcrumb li > h6 {
        margin-bottom: 0;
        margin-top: 0;
      }
  </style>
{{end}}
{{define "content"}}
  <div class="page-bar">
  </div>
  <h1 class="page-title"> {{ .title }} </h1>
  {{if .dateQS}}
      {{if not .newQS}}
          <p style="text-align: right;"><a href="/get-day-xls?date={{.dateQS}}" class="btn btn-sm blue"><i class="fa fa-file-excel-o"></i> Скачать <b style="color:blue;">весь</b> эксель за {{.dateQS}} </a></p>
      {{else}}
          <p style="text-align: right;">
            <a href="/report?date={{ .dateQS }}" class="btn btn-sm blue"> {{.dateQS}} </a>
            <a href="/get-new-xls?date={{.dateQS}}" class="btn btn-sm blue"><i class="fa fa-file-excel-o"></i> Скачать <b style="color:red;">new</b> эксель за {{.dateQS}} </a>
          </p>
      {{end}}
  {{end}}
  <table id="table_id" class="table table-striped table-bordered" style="font-family:Arial; font-size:12px;">

  </table>
{{end}}
{{define "extrajs"}}
  <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.13/js/dataTables.bootstrap.min.js"></script>
  <script type="text/javascript" charset="utf8" src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
  <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/plug-ins/1.10.13/dataRender/datetime.js"></script>
  <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/plug-ins/1.10.15/api/row().show().js"></script>
  <script>
      $(document).ready( function () {
        var dataByTypes = {{ .byTypes }};
        var dataTypes = [];
        for (var i=0; i<dataByTypes.length; i++){
          if (dataTypes[dataByTypes[i].Created]){
            dataTypes[dataByTypes[i].Created].push({"type": dataByTypes[i].HostType, "count": dataByTypes[i].Count});
          } else{
            dataTypes[dataByTypes[i].Created] = [{"type": dataByTypes[i].HostType, "count": dataByTypes[i].Count}];
          }
        }
        var dateRow = [{title:""}];
        var sourceHostRow = ["UniqHostSourceCount"];
        var countRow = ["Sum of links"];
        var typesRow = [["Types"],];
        var data = {{ .data }};
        for(i=0;i<data.length;i++){
          dateRow.push({title:data[i].Created});
          sourceHostRow.push(data[i].SourceHostCount);
          countRow.push(data[i].Count);
          if (dataTypes[data[i].Created]) {
            for (var j=0; j<dataTypes[data[i].Created].length; j++) {
              var d = dataTypes[data[i].Created][j].type + ": " + dataTypes[data[i].Created][j].count + "\n"
              if (typesRow[i+1] && typesRow[i+1].length > 0){
                typesRow[i+1] += d;
              }else{
                typesRow[i+1] = d;
              }
            }
          }
        }
        var datatableData = [sourceHostRow, countRow, typesRow];
        $("#table_id").DataTable({
          data: datatableData,
          searching: false,
          columns: dateRow,
          scrollX: true,
        });
      } );
      function qs(key) {
          key = key.replace(/[*+?^$.\[\]{}()|\\\/]/g, "\\$&"); // escape RegEx meta chars
          var match = location.search.match(new RegExp("[?&]"+key+"=([^&]+)(&|$)"));
          return match && decodeURIComponent(match[1].replace(/\+/g, " "));
      }
  </script>
{{end}}
