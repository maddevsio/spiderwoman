<html>
<head>
    <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.13/css/dataTables.bootstrap.min.css">
    <meta name="referrer" content="never">
    <script type="text/javascript" charset="utf8" src="//code.jquery.com/jquery-1.12.4.js"></script>
    <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.13/js/dataTables.bootstrap.min.js"></script>
    <script type="text/javascript" charset="utf8" src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
    <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/plug-ins/1.10.13/dataRender/datetime.js"></script>
    <script>
        $(document).ready( function () {
            var dateQS = "";
            var newQS = "";
            if (qs('date') != null) {
                dateQS = qs('date');
            }
            if (qs('new') != null) {
                newQS = qs('new');
            }

            $('.date-'+dateQS).css('color', 'red');
            $('#table_id').DataTable({
                pageLength: 200,
                ajax: {
                    url: '/all?date='+dateQS+'&new='+newQS,
                    dataSrc: ''
                },
                columns: [
                    { data: "Created" },
                    { data: "SourceHost" },
                    { data: "SourceHostType" },
                    { data: "ExternalHost" },
                    { data: "ExternalHostType" },
                    { data: "Count" },
                    { data: "ExternalLink" }
                ],
                columnDefs: [
                    {
                        targets: 0,
                        render: $.fn.dataTable.render.moment( '', 'Do MMM YYYY' )
                    },
                    {
                        targets: 3,
                        render: function ( data, type, row ) {
                            var info = '[<a href="?host=' + data + '">info</a>] '
                            var href = '<a target="blank" href="http://' + data + '">' + data + '</a>';
                            return info + href;
                        },
                    },
                    { sClass: "nwDate", aTargets: [ 0 ] }
                ],
                order: [[ 0, "desc" ]]
            });
        } );

        function qs(key) {
            key = key.replace(/[*+?^$.\[\]{}()|\\\/]/g, "\\$&"); // escape RegEx meta chars
            var match = location.search.match(new RegExp("[?&]"+key+"=([^&]+)(&|$)"));
            return match && decodeURIComponent(match[1].replace(/\+/g, " "));
        }

    </script>
    <style>
        .nwDate {
            white-space: nowrap;
        }
    </style>
</head>
<body style="padding: 15px 15px 15px 15px;">
<p style="text-align: right; font-size: small; padding:0; margin:0;">Server status: {{ .status }}</p>

{{if .dateQS}}
    <p style="text-align: right;"><a href="/xls/spiderwoman-{{.dateQS}}.xls">Скачать эксель за {{.dateQS}}</a></p>
{{end}}

<h1 style="text-align:center;">{{ .title }}</h1>
<div style="text-align: center; font-size: 10px;">
    <a href="/" class="date-">all</a>&nbsp;&nbsp;
    {{ range $date := .dates }}
        <a href="/?date={{ $date }}" class="date-{{ $date }}">{{ $date }}</a>:<a href="/?date={{ $date }}&new=1" class="date-{{ $date }}">new</a>
        &nbsp;|&nbsp;&nbsp;
    {{ end }}
</div>
<table id="table_id" class="table table-striped table-bordered" style="font-family:Arial; font-size:12px;">
    <thead>
    <tr>
        <th>Created</th>
        <th>SourceHost</th>
        <th>TypeSH</th>
        <th>ExternalHost</th>
        <th>TypeEH</th>
        <th>Count</th>
        <th>ExternalLink</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td class="nwDate">Created</td>
        <td>SourceHost</td>
        <td>TypeSH</td>
        <th>ExternalHost</th>
        <th>TypeEH</th>
        <th>Count</th>
        <th>ExternalLink</th>
    </tr>
    </tbody>
</table>
</body>
</html>
